var app;app=angular.module("ETimetable",["ngRoute"]),app.constant("config",{apiEndpoint:"http://anct.herokuapp.com/api/v1",defaultParams:{callback:"JSON_CALLBACK"}}),app.config(function(a){return a.when("/grades",{templateUrl:"./templates/grades.html",controller:"GradesCtrl"}).when("/:grade/departments",{templateUrl:"./templates/departments.html",controller:"DepartmentsCtrl"}).when("/:grade/:department/courses",{templateUrl:"./templates/courses.html",controller:"CoursesCtrl"}).when("/:grade/:department/timetables",{templateUrl:"./templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/:course/timetables",{templateUrl:"./templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/timetables/:wday",{templateUrl:"./templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/:course/timetables/:wday",{templateUrl:"./templates/timetables.html",controller:"TimetablesCtrl"}).when("/lectures/:id",{templateUrl:"./templates/lectures.html",controller:"LecturesCtrl"}).otherwise({redirectTo:"/grades"})});var Timetable;Timetable=function(){function a(a){var b;this.columns={},b={1:[],2:[],3:[],4:[],5:[]},angular.forEach(a,function(a){return b[a.wday].push(a)}),angular.forEach(b,function(a){return function(b,c){return a.columns[c]=new TimetableColumn(c,b)}}(this))}return a.prototype.find_cell=function(a,b){return angular.forEach(this.columns,function(c){return(c.wday=a)?c.find_cell(b):void 0})},a}();var TimetableColumn;TimetableColumn=function(){function a(a,b){var c;this.wday=a,this.cells={},c={1:[],2:[],3:[],4:[]},angular.forEach(b,function(a){return c[a.period].push(a)}),angular.forEach(c,function(b){return function(c,d){return b.cells[d]=new TimetableCell(a,d,c)}}(this))}return a.prototype.find_cell=function(a){return _.filter(this.cells,function(b){return b.period===a})},a}();var TimetableCell;TimetableCell=function(){function a(a,b,c){this.wday=a,this.period=b,this.lectures=c}return a.prototype.hasLectures=function(){return this.lectures.length>0},a.prototype.hasMultiLectures=function(){return this.lectures.length>1},a.prototype.title=function(a){var b;return null==a&&(a="/"),1===this.lectures.length?this.lectures[0].title:(b="",angular.forEach(this.lectures,function(c){return b+=""+a+c.title}),b.slice(a.length))},a.prototype.ids=function(){return 1===this.lectures.length?this.lectures[0].lectureId:_.map(this.lecture,function(a){return a.id})},a}();var app;app=angular.module("ETimetable"),app.factory("TimetablesService",function(a){return{cache:{},currentTab:0,changeTab:function(b){return this.currentTab=b,a.$broadcast("changeTab",b)}}});var app;app=angular.module("ETimetable"),app.filter("truncate",function(){return function(a,b,c){return isNaN(b)&&(b=10),null==c&&(c="..."),null==a||a.length<b?a:String(a).substring(0,b)+c}});var app;app=angular.module("ETimetable"),app.filter("noHTML",function(){return function(a){return null!=a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/,"&amp;"):void 0}}),app.filter("newlines",function(a){return function(b){return a.trustAsHtml(null!=b?b.replace(/\n/g,"<br />"):"")}});var app;app=angular.module("ETimetable"),app.controller("GradesCtrl",function(a){return a.grades=[{label:"1年",href:"#/1/departments"},{label:"2年",href:"#/2/departments"},{label:"3年",href:"#/3/departments"},{label:"4年",href:"#/4/departments"},{label:"5年",href:"#/5/departments"},{label:"専攻科1年",href:"#/1/adv/courses"},{label:"専攻科2年",href:"#/2/adv/courses"}],a.isAdvDept=function(a){return null!=a.department}});var app;app=angular.module("ETimetable"),app.controller("DepartmentsCtrl",function(a,b){var c;return c=function(a){return"#/"+b.grade+"/"+a+"/"+(b.grade>3&&"e"===a?"courses":"timetables")},a.departments=[{abbr:"m",label:"機械工学科",href:c("m")},{abbr:"e",label:"電気情報工学科",href:c("e")},{abbr:"c",label:"都市システム工学科",href:c("c")},{abbr:"a",label:"建築学科",href:c("a")}]});var app;app=angular.module("ETimetable"),app.controller("CoursesCtrl",function(a,b){var c,d;return c=b.department,d=function(a){return"#/"+b.grade+"/"+c+"/"+a+"/timetables"},"e"===c?a.courses=[{abbr:"d",label:"電気電子工学コース",href:d("d")},{abbr:"j",label:"情報工学コース",href:d("j")}]:"adv"===c?a.courses=[{abbr:"me",label:"機械・電子システム工学専攻",href:d("me")},{abbr:"ac",label:"建築・都市システム工学専攻",href:d("ac")}]:void 0});var app;app=angular.module("ETimetable"),app.controller("TimetablesCtrl",function(a,b,c,d,e,f){var g,h,i;return a.isLoading=!0,h={m:1,e:2,c:3,a:4,adv:5},g={d:1,j:2,me:3,ac:4},a.currentWday=Math.min(Math.max(c.wday||(new Date).getDay(),1),5),a.wdayJa=["日","月","火","水","木","金","土"],a.grade=c.grade,a.department={abbr:c.department,id:h[c.department]},a.course={abbr:c.course,id:g[c.course]},a.href=function(b){return null!=a.course.abbr?"#/"+a.grade+"/"+a.department.abbr+"/"+a.course.abbr+"/timetables/"+b:"#/"+a.grade+"/"+a.department.abbr+"/timetables/"+b},a.class_=5===a.department.id?(""+a.grade+a.course.abbr).toUpperCase():null!=a.course.abbr?(""+a.grade+a.department.abbr+a.course.abbr).toUpperCase():(""+a.grade+a.department.abbr).toUpperCase(),i=angular.extend({},{grade:a.grade,department:a.department.id,course:a.course.id}),i=angular.extend(i,e.defaultParams),f.changeTab(a.currentWday-1),null!=f.cache[a.class_]?(a.timetable=f.cache[a.class_],a.isLoading=!1):b.jsonp(""+e.apiEndpoint+"/timetables",{params:i}).success(function(b){return f.cache[a.class_]=a.timetable=new Timetable(b),a.isLoading=!1}),a.onCellClicked=function(a){return"number"==typeof a.ids()?d.url("lectures/"+a.ids()):a.active=!0},a.onModalSelected=function(a,b){return d.url("lectures/"+b.lectureId),a.active=!1},a.modalDismiss=function(a){return a.active=!1}});var app;app=angular.module("ETimetable"),app.controller("LecturesCtrl",function(a,b,c,d){return a.isLoading=!0,b.jsonp(""+d.apiEndpoint+"/lectures/"+c.id,{params:d.defaultParams}).success(function(b){var c;return c=b.lecture,a.lecture=c,a.department=c.department,a.class_=5===c.department.id?(""+c.grade+c.course.abbr).toUpperCase():null!=c.course.abbr?(""+c.grade+c.department.abbr+c.course.abbr).toUpperCase():(""+c.grade+c.department.abbr).toUpperCase(),a.isLoading=!1})});var app;app=angular.module("ETimetable"),app.directive("tabSet",function(){return{restrict:"E",replace:!0,templateUrl:"templates/tabset.html",transclude:!0,scope:{},controller:function(a,b){var c,d;d=a.tabs=[],c=b.currentTab,this.addTab=function(b){return d.push(b),d.length>c?a.select(d[c]):b.active=0===d.length},a.select=function(a){return angular.forEach(d,function(a){return a.active=!1}),a.active=!0},a.$on("changeTab",function(b,e){return c=e,d.length>e?a.select(d[e]):void 0})},link:function(){}}}),app.directive("tabPane",function(){return{require:"^tabSet",restrict:"E",replace:!0,templateUrl:"templates/tab.html",transclude:!0,scope:{heading:"@",href:"@"},link:function(a,b,c,d){return d.addTab(a)}}});var CLS_ACTIVE_DEFAULT,CLS_HOVER_DEFAULT,app;app=angular.module("ETimetable"),CLS_HOVER_DEFAULT="hover",CLS_ACTIVE_DEFAULT="active",app.directive("clsHover",function(){return{restrict:"A",link:function(a,b,c){var d;return d=c.clsHover||CLS_HOVER_DEFAULT,b.on("mouseenter",function(){return b.addClass(d)}),b.on("mouseleave",function(){return b.removeClass(d)})}}}),app.directive("clsActive",function(){return{restrict:"A",link:function(a,b,c){var d;return d=c.clsActive||CLS_ACTIVE_DEFAULT,b.on("touchstart mousedown",function(){return b.addClass(d)}),b.on("touchmove touchcancel touchend mousemove mouseup",function(){return b.removeClass(d)})}}});