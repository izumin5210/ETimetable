var app;app=angular.module("ETimetable",["ngRoute"]),app.constant("config",{apiEndpoint:"http://anct.herokuapp.com/api/v1",defaultParams:{callback:"JSON_CALLBACK"}}),app.config(function($routeProvider){return $routeProvider.when("/grades",{templateUrl:"templates/grades.html",controller:"GradesCtrl"}).when("/:grade/departments",{templateUrl:"templates/departments.html",controller:"DepartmentsCtrl"}).when("/:grade/:department/courses",{templateUrl:"templates/courses.html",controller:"CoursesCtrl"}).when("/:grade/:department/timetables",{templateUrl:"templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/:course/timetables",{templateUrl:"templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/timetables/:wday",{templateUrl:"templates/timetables.html",controller:"TimetablesCtrl"}).when("/:grade/:department/:course/timetables/:wday",{templateUrl:"templates/timetables.html",controller:"TimetablesCtrl"}).when("/lectures/:id",{templateUrl:"templates/lectures.html",controller:"LecturesCtrl"}).otherwise({redirectTo:"/grades"})}),angular.module("ETimetable").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("templates/courses.html",'<header class="header">\n  <h1>コースを選択</h1>\n</header>\n<ul class="card-set">\n  <li ng-repeat="course in courses">\n    <a ng-href="{{course.href}}" cls-hover cls-active class="card-item card-item-fixed card-item-shrinkable">\n      <abbr title="{{course.label}}" class="card-item-icon">{{course.abbr}}</abbr>\n      <span class="card-item-content">{{course.label}}</span>\n      <span class="card-item-caret"><i class="fa fa-chevron-right"></i></span>\n    </a>\n  </li>\n</ul>\n'),$templateCache.put("templates/departments.html",'<header class="header">\n  <h1>学科を選択</h1>\n</header>\n<ul class="card-set">\n  <li ng-repeat="department in departments">\n    <a ng-href="{{department.href}}" cls-hover cls-active class="card-item card-item-fixed card-item-shrinkable">\n      <abbr title="{{department.label}}" class="card-item-icon icon-{{department.abbr}}">{{department.abbr}}</abbr>\n      <span class="card-item-content">{{department.label}}</span>\n      <span class="card-item-caret"><i class="fa fa-chevron-right"></i></span>\n    </a>\n  </li>\n</ul>\n'),$templateCache.put("templates/grades.html",'<header class="header">\n  <h1>学年を選択</h1>\n</header>\n<ul class="card-set">\n  <li ng-repeat="grade in grades">\n    <a ng-href="{{grade.href}}" cls-hover cls-active class="card-item card-item-fixed card-item-shrinkable">\n      <span class="card-item-content">{{grade.label}}</span>\n      <span class="card-item-caret"><i class="fa fa-chevron-right"></i></span>\n    </a>\n  </li>\n</ul>\n'),$templateCache.put("templates/lectures.html",'<header class="header header-{{department.abbr}}">\n  <h1 ng-hide="isLoading">{{class_}}</h1>\n</header>\n\n<div ng-include="\'templates/loading.html\'" ng-show="isLoading"></div>\n\n<article class="card-set" ng-hide="isLoading">\n  <section class="card-item">\n    <h1>{{lecture.title}}</h1>\n    <ul class="slash-delimited-list">\n      <li ng-repeat="lecturer in lecture.lecturers">{{lecturer.name}}</li>\n    </ul>\n    <ul class="slash-delimited-list">\n      <li>{{lecture.term}}</li><li>{{lecture.divide}}</li><li>{{lecture.requiredSelective}}</li><li>{{lecture.credit}}単位</li>\n    </ul>\n    <h2>単位を落とすには</h2>\n    <p ng-bind-html="lecture.failureAbsence | noHTML | newlines"></p>\n    <h2>評価</h2>\n    <p ng-bind-html="lecture.evaluation | noHTML | newlines"></p>\n    <h2>概要</h2>\n    <p ng-bind-html="lecture.abstract | noHTML | newlines"></p>\n    <h2>テキスト（参考文献）</h2>\n    <p ng-bind-html="lecture.textbooks | noHTML | newlines"></p>\n    <h2>連絡先</h2>\n    <ul>\n      <li ng-repeat="contact in lecture.contacts">{{contact.email}}</li>\n    </ul>\n  </section>\n\n  <section class="card-item" ng-repeat="plan in lecture.plans | orderBy:\'number\'">\n    <h1>#{{plan.number}} {{plan.title}}</h1>\n    <p>{{plan.detail}}</p>\n  </section>\n</article>\n'),$templateCache.put("templates/loading.html",'<div class="card-set">\n  <div class="card-item card-item-fixed">\n    <span class="card-item-icon"><i class="fa fa-spinner fa-spin fa-lg"></i></span>\n    <span class="card-item-content">now loading...</span>\n  </div>\n</div>\n'),$templateCache.put("templates/tab.html",'<div class="tab-pane" ng-show="active" ng-transclude>\n</div>\n'),$templateCache.put("templates/tabset.html",'<div>\n  <ul class="nav-tabs">\n    <li ng-repeat="tab in tabs" class="tab" cls-hover="tab-hover" cls-active="tab-click" ng-class="{active: tab.active}">\n      <a ng-href="{{tab.href}}">{{tab.heading}}</a>\n    </li>\n  </ul>\n  <div class="tab-content" ng-transclude>\n  </div>\n</div>\n'),$templateCache.put("templates/timetables.html",'<header class="header header-{{department.abbr}}">\n  <h1>{{class_}}</h1>\n</header>\n\n<div ng-include="\'templates/loading.html\'" ng-show="isLoading"></div>\n\n<tab-set ng-hide="isLoading">\n  <tab-pane ng-repeat="wday in [1, 2, 3, 4, 5]" heading="{{wdayJa[wday]}}" href="{{href(wday)}}">\n    <ol class="card-set">\n      <li ng-repeat="(period, cell) in timetable.columns[wday].cells">\n        <a ng-click="onCellClicked(cell)" cls-hover cls-active class="card-item card-item-fixed" ng-class="{\'card-item-shrinkable\': cell.hasLectures(), \'card-item-disable\':!cell.hasLectures()}">\n          <span class="card-item-icon icon-{{department.abbr}}">{{period}}</span>\n          <span class="card-item-content">{{cell.title() | truncate:13}}</span>\n          <span class="card-item-caret"><i class="fa fa-chevron-right"></i></span>\n        </a>\n        <div class="modal-wrapper" ng-if="cell.hasMultiLectures()" ng-show="cell.active" ng-click="modalDismiss(cell)">\n          <div class="modal">\n            <header class="header header-{{department.abbr}}">\n              <h1>科目を選択</h1>\n            </header>\n            <ul class="card-set">\n              <li ng-repeat="lecture in cell.lectures">\n                <a ng-click="onModalSelected(cell, lecture)" cls-hover cls-active class="card-item card-item-fixed card-item-shrinkable">\n                  <span class="card-item-icon icon-{{department.abbr}}">{{period}}</span>\n                  <span class="card-item-content">{{lecture.title | truncate:13}}</span>\n                  <span class="card-item-caret"><i class="fa fa-chevron-right"></i></span>\n                </a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </li>\n    </ol>\n  </tab-pane>\n</tab-set>\n\n')}]);var Timetable;Timetable=function(){function Timetable(timetables){var lectures;this.columns={},lectures={1:[],2:[],3:[],4:[],5:[]},angular.forEach(timetables,function(l){return lectures[l.wday].push(l)}),angular.forEach(lectures,function(_this){return function(column,wday){return _this.columns[wday]=new TimetableColumn(wday,column)}}(this))}return Timetable.prototype.find_cell=function(wday,period){return angular.forEach(this.columns,function(col){return(col.wday=wday)?col.find_cell(period):void 0})},Timetable}();var TimetableColumn;TimetableColumn=function(){function TimetableColumn(wday,column){var lectures;this.wday=wday,this.cells={},lectures={1:[],2:[],3:[],4:[]},angular.forEach(column,function(l){return lectures[l.period].push(l)}),angular.forEach(lectures,function(_this){return function(cell,period){return _this.cells[period]=new TimetableCell(wday,period,cell)}}(this))}return TimetableColumn.prototype.find_cell=function(period){return _.filter(this.cells,function(cell){return cell.period===period})},TimetableColumn}();var TimetableCell;TimetableCell=function(){function TimetableCell(wday,period,cell){this.wday=wday,this.period=period,this.lectures=cell}return TimetableCell.prototype.hasLectures=function(){return this.lectures.length>0},TimetableCell.prototype.hasMultiLectures=function(){return this.lectures.length>1},TimetableCell.prototype.title=function(delimiter){var title;return null==delimiter&&(delimiter="/"),1===this.lectures.length?this.lectures[0].title:(title="",angular.forEach(this.lectures,function(l){return title+=""+delimiter+l.title}),title.slice(delimiter.length))},TimetableCell.prototype.ids=function(){return 1===this.lectures.length?this.lectures[0].lectureId:_.map(this.lecture,function(l){return l.id})},TimetableCell}();var app;app=angular.module("ETimetable"),app.factory("TimetablesService",function($rootScope){return{cache:{},currentTab:0,changeTab:function(index){return this.currentTab=index,$rootScope.$broadcast("changeTab",index)}}});var app;app=angular.module("ETimetable"),app.filter("truncate",function(){return function(text,length,terminator){return isNaN(length)&&(length=10),null==terminator&&(terminator="..."),null==text||text.length<length?text:String(text).substring(0,length)+terminator}});var app;app=angular.module("ETimetable"),app.filter("noHTML",function(){return function(text){return null!=text?text.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/,"&amp;"):void 0}}),app.filter("newlines",function($sce){return function(text){return $sce.trustAsHtml(null!=text?text.replace(/\n/g,"<br />"):"")}});var app;app=angular.module("ETimetable"),app.controller("GradesCtrl",function($scope){return $scope.grades=[{label:"1年",href:"#/1/departments"},{label:"2年",href:"#/2/departments"},{label:"3年",href:"#/3/departments"},{label:"4年",href:"#/4/departments"},{label:"5年",href:"#/5/departments"},{label:"専攻科1年",href:"#/1/adv/courses"},{label:"専攻科2年",href:"#/2/adv/courses"}],$scope.isAdvDept=function(grade){return null!=grade.department}});var app;app=angular.module("ETimetable"),app.controller("DepartmentsCtrl",function($scope,$routeParams){var getHref;return getHref=function(department){return"#/"+$routeParams.grade+"/"+department+"/"+($routeParams.grade>3&&"e"===department?"courses":"timetables")},$scope.departments=[{abbr:"m",label:"機械工学科",href:getHref("m")},{abbr:"e",label:"電気情報工学科",href:getHref("e")},{abbr:"c",label:"都市システム工学科",href:getHref("c")},{abbr:"a",label:"建築学科",href:getHref("a")}]});var app;app=angular.module("ETimetable"),app.controller("CoursesCtrl",function($scope,$routeParams){var department,getHref;return department=$routeParams.department,getHref=function(courses){return"#/"+$routeParams.grade+"/"+department+"/"+courses+"/timetables"},"e"===department?$scope.courses=[{abbr:"d",label:"電気電子工学コース",href:getHref("d")},{abbr:"j",label:"情報工学コース",href:getHref("j")}]:"adv"===department?$scope.courses=[{abbr:"me",label:"機械・電子システム工学専攻",href:getHref("me")},{abbr:"ac",label:"建築・都市システム工学専攻",href:getHref("ac")}]:void 0});var app;app=angular.module("ETimetable"),app.controller("TimetablesCtrl",function($scope,$http,$routeParams,$location,config,TimetablesService){var courseIds,departmentIds,params;return $scope.isLoading=!0,departmentIds={m:1,e:2,c:3,a:4,adv:5},courseIds={d:1,j:2,me:3,ac:4},$scope.currentWday=Math.min(Math.max($routeParams.wday||(new Date).getDay(),1),5),$scope.wdayJa=["日","月","火","水","木","金","土"],$scope.grade=$routeParams.grade,$scope.department={abbr:$routeParams.department,id:departmentIds[$routeParams.department]},$scope.course={abbr:$routeParams.course,id:courseIds[$routeParams.course]},$scope.href=function(wday){return null!=$scope.course.abbr?"#/"+$scope.grade+"/"+$scope.department.abbr+"/"+$scope.course.abbr+"/timetables/"+wday:"#/"+$scope.grade+"/"+$scope.department.abbr+"/timetables/"+wday},$scope.class_=5===$scope.department.id?(""+$scope.grade+$scope.course.abbr).toUpperCase():null!=$scope.course.abbr?(""+$scope.grade+$scope.department.abbr+$scope.course.abbr).toUpperCase():(""+$scope.grade+$scope.department.abbr).toUpperCase(),params=angular.extend({},{grade:$scope.grade,department:$scope.department.id,course:$scope.course.id}),params=angular.extend(params,config.defaultParams),TimetablesService.changeTab($scope.currentWday-1),null!=TimetablesService.cache[$scope.class_]?($scope.timetable=TimetablesService.cache[$scope.class_],$scope.isLoading=!1):$http.jsonp(""+config.apiEndpoint+"/timetables",{params:params}).success(function(data){return TimetablesService.cache[$scope.class_]=$scope.timetable=new Timetable(data),$scope.isLoading=!1}),$scope.onCellClicked=function(cell){return"number"==typeof cell.ids()?$location.url("lectures/"+cell.ids()):cell.active=!0},$scope.onModalSelected=function(cell,lecture){return $location.url("lectures/"+lecture.lectureId),cell.active=!1},$scope.modalDismiss=function(cell){return cell.active=!1}});var app;app=angular.module("ETimetable"),app.controller("LecturesCtrl",function($scope,$http,$routeParams,config){return $scope.isLoading=!0,$http.jsonp(""+config.apiEndpoint+"/lectures/"+$routeParams.id,{params:config.defaultParams}).success(function(data){var l;return l=data.lecture,$scope.lecture=l,$scope.department=l.department,$scope.class_=5===l.department.id?(""+l.grade+l.course.abbr).toUpperCase():null!=l.course.abbr?(""+l.grade+l.department.abbr+l.course.abbr).toUpperCase():(""+l.grade+l.department.abbr).toUpperCase(),$scope.isLoading=!1})});var app;app=angular.module("ETimetable"),app.directive("tabSet",function(){return{restrict:"E",replace:!0,templateUrl:"templates/tabset.html",transclude:!0,scope:{},controller:function($scope,TimetablesService){var selected,tabs;tabs=$scope.tabs=[],selected=TimetablesService.currentTab,this.addTab=function(tab){return tabs.push(tab),tabs.length>selected?$scope.select(tabs[selected]):tab.active=0===tabs.length},$scope.select=function(tab){return angular.forEach(tabs,function(tab){return tab.active=!1}),tab.active=!0},$scope.$on("changeTab",function(event,index){return selected=index,tabs.length>index?$scope.select(tabs[index]):void 0})},link:function(){}}}),app.directive("tabPane",function(){return{require:"^tabSet",restrict:"E",replace:!0,templateUrl:"templates/tab.html",transclude:!0,scope:{heading:"@",href:"@"},link:function(scope,element,attrs,ctrl){return ctrl.addTab(scope)}}});var CLS_ACTIVE_DEFAULT,CLS_HOVER_DEFAULT,app;app=angular.module("ETimetable"),CLS_HOVER_DEFAULT="hover",CLS_ACTIVE_DEFAULT="active",app.directive("clsHover",function(){return{restrict:"A",link:function(scope,element,attrs){var clsHover;return clsHover=attrs.clsHover||CLS_HOVER_DEFAULT,element.on("mouseenter",function(){return element.addClass(clsHover)}),element.on("mouseleave",function(){return element.removeClass(clsHover)})}}}),app.directive("clsActive",function(){return{restrict:"A",link:function(scope,element,attrs){var clsActive;return clsActive=attrs.clsActive||CLS_ACTIVE_DEFAULT,element.on("touchstart mousedown",function(){return element.addClass(clsActive)}),element.on("touchmove touchcancel touchend mousemove mouseup",function(){return element.removeClass(clsActive)})}}});